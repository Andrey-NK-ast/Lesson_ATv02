<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Результаты расчета</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Russo One', Arial, sans-serif;
            background: linear-gradient(135deg, #181818 0%, #191d1e 100%);
            min-height: 100vh;
            padding: 30px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #24272c;
            border-radius: 20px;
            border: 2.5px solid #bbbbbbcc;
            box-shadow: 0 12px 40px 0 #0a0a0a, 0 2px 10px #ff2300AA;
            padding: 48px 38px 42px 38px;
        }
        h1 {
            color: #ededed;
            text-align: center;
            margin-bottom: 38px;
            font-size: 37px;
            letter-spacing: 2px;
            position: relative;
            font-family: 'Russo One', Arial, sans-serif;
            text-shadow: 0 2px 10px #fff2, 0 0 30px #ff4500cc, 2px 2px 0 #3336;
        }
        .h1-icon {
            display: inline-block;
            width: 36px;
            height: 36px;
            vertical-align: middle;
            margin-left: 6px;
        }
        .summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 22px;
            margin-bottom: 44px;
        }
        .summary-card {
            background: #141518;
            color: #fff;
            padding: 30px 28px;
            border-radius: 12px;
            box-shadow: 0 2px 12px #0007;
            text-align: center;
            border: 1.3px solid #ff2a00cd;
        }
        .summary-card h3 {
            font-size: 18px;
            margin-bottom: 12px;
            color: #ff8000;
            letter-spacing: 1px;
            text-shadow: 0 2px 10px #ff8000cc, 0 1px 0 #0008;
        }
        .summary-card .value {
            font-size: 32px;
            font-weight: bold;
            color: #fff;
            text-shadow: 0 2px 14px #ff0900cc;
        }
        .info-section {
            background: #232323d4;
            padding: 22px 24px 12px 24px;
            border-radius: 13px;
            margin-bottom: 35px;
            color: #dfdfdf;
            border: 1.7px solid #868686bd;
            box-shadow: 0 1.5px 8px #0007;
        }
        .info-section h2 {
            color: #ff9500;
            margin-bottom: 13px;
            font-size: 22px;
            letter-spacing: 1.2px;
            text-shadow: 0 1px 10px #ffaa00aa;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #494949;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        .info-label {
            color: #b7b6b6;
            letter-spacing: 1px;
        }
        .info-value {
            color: #fff;
            font-weight: bold;
            text-shadow: 0 2px 8px #eee2;
        }
        .schedule { overflow-x: auto; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
            background: #17181b;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 16px #0009;
        }
        th {
            background: linear-gradient(90deg, #232323 0%, #373737 100%);
            color: #ff4200;
            padding: 13px;
            text-align: left;
            font-weight: bold;
            font-size: 16px;
            border-bottom: 2px solid #ff4200ee;
        }
        td {
            padding: 11px 13px;
            border-bottom: 1px solid #474747cc;
            color: #f7f7f7;
            font-size: 15px;
        }
        tr:hover {
            background: #27292f;
        }
        .btn-back {
            display: inline-block;
            margin-top: 30px;
            padding: 14px 36px;
            background: linear-gradient(135deg,#750000 0%,#ff3300 45%,#ff9100 100%);
            color: white;
            text-decoration: none;
            border-radius: 11px;
            font-weight: bold;
            font-size: 20px;
            text-shadow: 0 1px 12px #fff1,0 0 8px #ff8000cc;
            box-shadow: 0 3px 26px 1px #ff220066, 0 1.5px 8px #000c;
            border: 2px solid #fff4;
            transition: transform 0.15s;
            letter-spacing: 1.1px;
        } .btn-back:hover {
            transform: scale(1.04) rotate(-1.5deg);
            background: linear-gradient(135deg,#ff5900 0%,#ff9100 100%);
            border-color: #ff9100;
            color: #fff;
        }
        .currency { font-size: 0.9em; }
        #pieChart { background: #161616; border-radius: 50%; }
        #flashlight {
  position:fixed;
  left:0;top:0;width:100vw;height:100vh;
  pointer-events:none;
  z-index:1000;
  background: radial-gradient(circle at 60% 20%, #fff 6%, #ffe091a0 25%, #ff4300bb 76%, transparent 94%);
  animation: flashboom 1.1s cubic-bezier(.8,0,.3,1);
}
@keyframes flashboom {
  0% {opacity:0;}
 10% {opacity:.95;}
 25% {opacity:1;}
 42% {opacity:.90;}
 75% {opacity:.3;}
 100%{opacity:0;}
}
        @media (max-width: 680px) {
            .container {
                max-width: 100%;
                padding: 7px;
            }
            .summary { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Результаты расчета ипотеки
 <span class="h1-icon"> 
   <svg viewBox="0 0 40 40" width="36" height="36">
     <linearGradient id="firegrad" x1="0" y1="0" x2="0" y2="1">
       <stop offset="0%" stop-color="#fffcc5"/>
       <stop offset="80%" stop-color="#ff9400"/> 
       <stop offset="100%" stop-color="#c90000"/>
     </linearGradient>
     <circle cx="20" cy="20" r="18" fill="url(#firegrad)" stroke="#ff5200" stroke-width="2.5"/>
     <rect x="9" y="19" width="22" height="6" rx="2.4" fill="#222"/>
     <rect x="26" y="15" width="7" height="8" rx="2" fill="#999" stroke="#fff7" stroke-width="1.2"/>
     <ellipse cx="21" cy="22" rx="9" ry="5" fill="#b5b5b5ff" stroke="#222" stroke-width="1.2"/>
   </svg>
 </span>
</h1>
        
        <div class="summary">
            <div class="summary-card">
                <h3>Ежемесячный платеж</h3>
                <div class="value">{{ monthly_payment|money }} ₽</div>
            </div>
            <div class="summary-card">
                <h3>Общая сумма выплат</h3>
                <div class="value">{{ total_payment|money }} ₽</div>
            </div>
            <div class="summary-card">
                <h3>Переплата</h3>
                <div class="value">{{ (total_payment - principal)|money }} ₽</div>
            </div>
        </div>
        
        <div style="max-width:400px; margin: 35px auto 45px;">
  <canvas id="pieChart"></canvas>
</div>
<script>
document.addEventListener('DOMContentLoaded',function(){
    if (window.performance && performance.getEntriesByType('navigation')[0].type==='navigate') {
        const f=document.createElement('div');f.id='flashlight';document.body.appendChild(f);
        setTimeout(()=>{f.remove();},1200);
    }
});
</script>
<script>
const data = {
  labels: ['Основной долг', 'Проценты'],
  datasets: [{
    label: 'Распределение выплат',
    data: [{{ principal_total }}, {{ interest_total }}],
    backgroundColor: [
      'rgba(54, 136, 219, 0.93)', // темно-синий
      'rgba(255, 153, 15, 0.93)' // огненно-оранж
    ],
    borderColor: ['#dde8ff', '#ffd884'],
    borderWidth: 3
  }]
};
const config = {
  type: 'pie',
  data: data,
  options: {
    plugins: {
      legend: {display: true,position: 'bottom',labels: {font:{size:16},color:'#fff'}},
      datalabels: {
        display: true,
        color: '#fff',
        font: { weight:'bold',size:22 },
        borderRadius:8,
        formatter: (value,ctx)=> `${ctx.chart.data.labels[ctx.dataIndex]}\n${value.toLocaleString('ru-RU')} ₽` 
      }
    }
  },
  plugins: [ChartDataLabels]
};
window.addEventListener('DOMContentLoaded', ()=>{
    new Chart(document.getElementById('pieChart'), config);
});
</script>
        
        <div class="info-section">
            <h2>Параметры кредита</h2>
            <div class="info-row">
                <span class="info-label">Сумма кредита:</span>
                <span class="info-value">{{ loan_amount|money }} ₽</span>
            </div>
            <div class="info-row">
                <span class="info-label">Первоначальный взнос:</span>
                <span class="info-value">{{ down_payment|money }} ₽</span>
            </div>
            <div class="info-row">
                <span class="info-label">Сумма займа:</span>
                <span class="info-value">{{ principal|money }} ₽</span>
            </div>
            <div class="info-row">
                <span class="info-label">Переплата:</span>
                <span class="info-value">{{ ('%.1f' % ((total_payment - principal) / principal * 100)) }} %</span>
            </div>
            <div class="info-row">
                <span class="info-label">Процентная ставка:</span>
                <span class="info-value">{{ "%.2f"|format(interest_rate) }}% годовых</span>
            </div>
            <div class="info-row">
                <span class="info-label">Срок кредита:</span>
                <span class="info-value">{{ loan_term }} месяцев ({{ "%.1f"|format(loan_term / 12) }} лет)</span>
            </div>
        </div>
        
        <div class="info-section">
            <h2>График платежей</h2>
            <div class="schedule">
                <table>
                    <thead>
                        <tr>
                            <th>Месяц</th>
                            <th>Платеж</th>
                            <th>Основной долг</th>
                            <th>Проценты</th>
                            <th>Остаток долга</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for payment in payment_schedule %}
                        <tr>
                            <td>{{ payment.month }}</td>
                            <td>{{ payment.payment|money }} ₽</td>
                            <td>{{ payment.principal|money }} ₽</td>
                            <td>{{ payment.interest|money }} ₽</td>
                            <td>{{ payment.remaining|money }} ₽</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <a href="/" class="btn-back">Новый расчет</a>
    </div>
</body>
</html>

